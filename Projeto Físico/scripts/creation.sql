-------------------
-- CRIAÇÃO DO BD --
-------------------

--Tabela Aldeia
CREATE TABLE ALDEIA(NOME VARCHAR(20) PRIMARY KEY);

--Tabela Ninja
CREATE TABLE NINJA(
  RG_NINJA VARCHAR(9), 
  NOME_CLA VARCHAR(20), 
  NOME VARCHAR (20),
  NOME_ALDEIA VARCHAR(20),
  PRIMARY KEY (RG_NINJA),
  FOREIGN KEY (NOME_ALDEIA) REFERENCES ALDEIA(NOME)
);

CREATE TABLE RIVALIDADE (
  RG_NINJA VARCHAR(9),
  RG_RIVAL VARCHAR(9),
  PRIMARY KEY (RG_NINJA, RG_RIVAL),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA),
  FOREIGN KEY (RG_RIVAL) REFERENCES NINJA(RG_NINJA)
);

CREATE TYPE RANK AS ENUM ('D', 'C', 'B', 'A', 'S', 'SS');
CREATE TYPE ELEMENTO AS ENUM (
  'KATON',   -- Fogo
  'SUITON',  -- Água
  'DOTON',   -- Terra
  'FUUTON',  -- Vento
  'RAITON',  -- Raio
  'MOKUTON', -- Madeira
  'YOTON',   -- Lava
  'HYOTON',  -- Gelo
  'RANTON',  -- Tempestade
  'JITON',   -- Magnetismo
  'SHOTON',  -- Cristal
  'FUTTON',  -- Vapor
  'ENTON',   -- Chama negra
  'BAKUTON'  -- Explosão
);

CREATE TABLE JUTSU(
  RG_NINJA VARCHAR(9), 
  NOME VARCHAR (20), 
  ELEMENTO ELEMENTO,
  RANK RANK,
  PRIMARY KEY(RG_NINJA, NOME)
);

--heranças
--TO BE FIXED
CREATE TABLE HOKAGE(
  RG_NINJA VARCHAR(9),
  PRIMARY KEY (RG_NINJA),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA)
);

CREATE TABLE JOUNIN(
  RG_NINJA VARCHAR(9),
  PRIMARY KEY (RG_NINJA),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA)
);

CREATE TABLE CHUNNIN(
  RG_NINJA VARCHAR(9),
  PRIMARY KEY (RG_NINJA),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA)
);

CREATE TABLE GENNIN(
  RG_NINJA VARCHAR(9),
  PRIMARY KEY (RG_NINJA),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA)
);

-- Tabela equipe
CREATE TABLE EQUIPE(NUMERO INTEGER PRIMARY KEY);

-- Tabelas de entidade fraca
CREATE TABLE MISSAO(
  EQUIPE INTEGER,
  DATA_FINALIZACAO DATE,
  RANK RANK,
  RECOMPENSA NUMERIC(10,2),
  DESCRICAO VARCHAR(300),
  PRIMARY KEY (EQUIPE, DATA_FINALIZACAO),
  FOREIGN KEY (EQUIPE) REFERENCES EQUIPE(NUMERO)
);

CREATE TABLE EXAME_CHUNNIN(
  ALDEIA VARCHAR(20),
  DATA_INICIO DATE,
  PRIMARY KEY (ALDEIA, DATA_INICIO),
  FOREIGN KEY (ALDEIA) REFERENCES ALDEIA(NOME)
);


-- tabela de relações N:N
CREATE TABLE JOUNIN_AVALIA_GENNIN(
  RG_NINJA_AVALIADO VARCHAR(9),
  RG_NINJA_AVALIADOR VARCHAR(9),
  MISSAO_EQUIPE INTEGER,
  DATA_FINALIZACAO_EQUIPE DATE,
  PRIMARY KEY (RG_NINJA_AVALIADO, RG_NINJA_AVALIADOR, MISSAO_EQUIPE, DATA_FINALIZACAO_EQUIPE),
  FOREIGN KEY (RG_NINJA_AVALIADO) REFERENCES GENNIN(RG_NINJA),
  FOREIGN KEY (RG_NINJA_AVALIADOR) REFERENCES JOUNIN(RG_NINJA),
  FOREIGN KEY (MISSAO_EQUIPE, DATA_FINALIZACAO_EQUIPE) REFERENCES MISSAO(EQUIPE, DATA_FINALIZACAO)
);

CREATE TABLE NINJA_COMPOE_EQUIPE(
  RG_NINJA VARCHAR(9),
  MISSAO_EQUIPE INTEGER,
  MISSAO_DATA_FINALIZACAO DATE,
  PRIMARY KEY (RG_NINJA, MISSAO_EQUIPE, MISSAO_DATA_FINALIZACAO),
  FOREIGN KEY (RG_NINJA) REFERENCES NINJA(RG_NINJA),
  FOREIGN KEY (MISSAO_EQUIPE, MISSAO_DATA_FINALIZACAO) REFERENCES MISSAO(EQUIPE, DATA_FINALIZACAO)
);

--tabela associativa
CREATE TABLE PARTICIPA(
  RG_JOUNIN_AVALIADOR VARCHAR(9),
  RG_GENNIN_EXAMINADO VARCHAR(9),
  EXAME_CHUNNIN_ALDEIA VARCHAR(20),
  EXAME_CHUNNIN_DATA_INICIO DATE,
  RG_CHUNNIN_ASSISTE VARCHAR(9),
  PRIMARY KEY(RG_GENNIN_EXAMINADO,RG_JOUNIN_AVALIADOR,EXAME_CHUNNIN_ALDEIA,EXAME_CHUNNIN_DATA_INICIO),
  FOREIGN KEY (RG_JOUNIN_AVALIADOR) REFERENCES JOUNIN(RG_NINJA),
  FOREIGN KEY (RG_GENNIN_EXAMINADO) REFERENCES GENNIN(RG_NINJA),
  FOREIGN KEY (EXAME_CHUNNIN_ALDEIA, EXAME_CHUNNIN_DATA_INICIO) REFERENCES EXAME_CHUNNIN(ALDEIA, DATA_INICIO),
  FOREIGN KEY (RG_CHUNNIN_ASSISTE) REFERENCES CHUNNIN(RG_NINJA)
);


-- ALDEIA
INSERT INTO ALDEIA VALUES 
  ('Konoha'), 
  ('Suna'), 
  ('Kiri'), 
  ('Kumo'), 
  ('Iwa');

-- EQUIPE
INSERT INTO EQUIPE VALUES 
  (7), 
  (10), 
  (4), 
  (3), 
  (1);

-- EXAME CHUNNIN
INSERT INTO EXAME_CHUNNIN VALUES 
  ('Konoha', '2024-01-10'),
  ('Suna',   '2024-06-15'),
  ('Kiri',   '2024-08-20');

-- NINJA (RG, CLA, NOME, ALDEIA)
INSERT INTO NINJA VALUES
  ('111111111', 'Uchiha',  'Sasuke',    'Konoha'),
  ('222222222', 'Uzumaki', 'Naruto',    'Konoha'),
  ('333333333', 'Hatake',  'Kakashi',   'Konoha'),
  ('444444444', 'Nara',    'Shikamaru', 'Konoha'),
  ('555555555', 'Sabaku',  'Gaara',     'Suna'),
  ('666666666', 'Yamanaka','Ino',       'Konoha'),
  ('777777777', 'Akimichi','Chouji',    'Konoha'),
  ('888888888', 'Aburame', 'Shino',     'Konoha'),
  ('999999999', 'Hozuki',  'Suigetsu',  'Kiri'),
  ('121212121', 'Sarutobi','Konohamaru','Konoha'),
  ('101010101', 'Sarutobi', 'Asuma',  'Konoha'),
  ('202020202', 'Yuhi',     'Kurenai','Konoha');

-- HERANÇAS
-- GENNIN
INSERT INTO GENNIN VALUES 
  ('111111111'), 
  ('222222222'), 
  ('444444444'), 
  ('666666666'), 
  ('777777777'), 
  ('888888888'), 
  ('121212121');

-- CHUNNIN
INSERT INTO CHUNNIN VALUES 
  ('444444444'), 
  ('666666666');

-- JOUNIN
INSERT INTO JOUNIN VALUES 
  ('333333333'), 
  ('555555555'),
  ('101010101'),
  ('202020202');

-- HOKAGE
INSERT INTO HOKAGE VALUES 
  ('333333333');

-- RIVALIDADE
INSERT INTO RIVALIDADE VALUES
  ('111111111', '222222222'),
  ('222222222', '111111111'),
  ('444444444', '666666666'),
  ('666666666', '444444444'),
  ('121212121', '222222222');

-- JUTSUS
INSERT INTO JUTSU VALUES
  ('111111111', 'Chidori',       'RAITON',  'A'),
  ('222222222', 'Rasengan',      'FUUTON',  'A'),
  ('333333333', 'Raikiri',       'RAITON',  'S'),
  ('444444444', 'Kagemane',      'DOTON',   'B'),
  ('555555555', 'Sabaku Kyuu',   'DOTON',   'A'),
  ('666666666', 'Shintenshin',   'YOTON',   'C'),
  ('777777777', 'Baika no Jutsu','DOTON',   'D'),
  ('888888888', 'Insekto Bomba', 'RANTON',  'C'),
  ('999999999', 'Water Gun',     'SUITON',  'B'),
  ('121212121','Sexy Jutsu',     'FUUTON',  'D');

-- MISSAO (EQUIPE, DATA, RANK, RECOMPENSA, DESC)
INSERT INTO MISSAO VALUES 
  (7,  '2024-02-15', 'B',  800.00,  'Proteção de diplomata em zona neutra'),
  (10, '2024-03-22', 'A', 1500.00, 'Espionagem em vila inimiga'),
  (4,  '2024-01-01', 'C', 500.00,  'Patrulha de fronteira'),
  (3,  '2024-04-20', 'D', 200.00,  'Entrega de mensagem urgente'),
  (1,  '2024-05-12', 'S', 3000.00, 'Captura de criminoso classe S');

-- NINJA_COMPOE_EQUIPE
INSERT INTO NINJA_COMPOE_EQUIPE VALUES
  ('111111111', 7,  '2024-02-15'),
  ('222222222', 7,  '2024-02-15'),
  ('333333333', 7,  '2024-02-15'),

  ('444444444', 10, '2024-03-22'),
  ('555555555', 10, '2024-03-22'),
  ('333333333', 10, '2024-03-22'),

  ('666666666', 4,  '2024-01-01'),
  ('777777777', 4,  '2024-01-01'),

  ('888888888', 3,  '2024-04-20'),

  ('121212121', 1,  '2024-05-12');

-- JOUNIN_AVALIA_GENNIN
INSERT INTO JOUNIN_AVALIA_GENNIN VALUES
  ('111111111', '333333333', 7,  '2024-02-15'),
  ('222222222', '333333333', 7,  '2024-02-15'),
  ('444444444', '555555555', 10, '2024-03-22'),
  ('666666666', '555555555', 10, '2024-03-22'),
  ('121212121','333333333',  1,  '2024-05-12');

-- PARTICIPA (JOUNIN, GENNIN, ALDEIA, DATA)
INSERT INTO PARTICIPA VALUES
  ('333333333', '111111111', 'Konoha', '2024-01-10', '444444444'),
  ('333333333', '222222222', 'Konoha', '2024-01-10', '666666666'),
  ('555555555', '444444444', 'Suna',   '2024-06-15', '666666666'),
  ('555555555', '666666666', 'Suna',   '2024-06-15', NULL),
  ('333333333', '121212121', 'Konoha', '2024-01-10', NULL);
